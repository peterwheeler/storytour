var tour = {};

// Name and Locale ID for each language of the site.
// First in list is considered the preferred language.
// Helpful list below:
// http://www.i18nguy.com/unicode/language-identifiers.html

tour.languages = [ 
	{	
		id: 1,
		name: "English",
		locale: "en-gb"
	},
	{
		id: 2,
		name: "Español",
		locale: "es-es"
	},
	{
		id: 3,
		name: "Italiano",
		locale: "it-it"
	}
];

// Name of each pages for the site.
// All are neccessary. Do not change unless you know what you're doing.
// First in list is considered the preferred and first loaded tour.

tour.pages = [
	{
		name: "About",
		url: "about",
		title: "About Storytour"
	}
];

tour.maps = [
	{
		id: 1,
		name: "Tour one",
		url: "tour-1", // Used as url
		title: "Tour one",
		language: "",
		maps: [{
			map_type: "mapTiler",
			map_name: "Map one",
			map_mini: false,
			map_as_image: false,
			map_as_overlay: false,
			calculate_zoom: false,
			attribution: 		"Maps designed by <a href='https://artasmedia.com/' target='_blank' class='vco-knightlab-brand'>ArtasMedia</a>",
			mapTiler: {
				path: 				"http://www.southampton.ac.uk/~pw8g08/tour/maps/plan_en_01/",
				lat:				"",
				lng: 				"",
				zoom: 				14,
				minZoom:        	14,
				maxZoom:        	17
			}	
		},
		{
			map_type: "mapTiler",
			map_name: "Plan one",
			map_mini: false,
			map_as_image: false,
			map_as_overlay: false,
			calculate_zoom: false,
			attribution: 		'Maps designed by <a href="https://artasmedia.com/" target="_blank" class="vco-knightlab-brand">ArtasMedia</a>',
			mapTiler: {
				path: 				"http://www.southampton.ac.uk/~pw8g08/tour/maps/plan_en_02/",
				lat:				"",
				lng: 				"",
				zoom: 				14,
				minZoom:        	14,
				maxZoom:        	17
				
			}
		}],
		overlays: [{
			imageUrl: "",
			imageBounds: "",
			imageOptions: {
				"opacity": "",
				"attribution": ""
			}
		}]
	},
	{
		id: 2,
		name: "Tour two",
		url: "tour-2",
		title: "Tour two",
		language: "",
		maps: [{
			map_type: "mapTiler",
			map_name: "Map two",
			map_mini: false,
			map_as_image: false,
			map_as_overlay: false,
			calculate_zoom: false,
			attribution: 		'Maps designed by <a href="https://artasmedia.com/" target="_blank" class="vco-knightlab-brand">ArtasMedia</a>',
			mapTiler: {
				path: 				"http://www.southampton.ac.uk/~pw8g08/tour/maps/plan_en_03/",
				lat:				"",
				lng: 				"",
				zoom: 				14,
				minZoom:        	14,
				maxZoom:        	17
				
			}	
		},
		{
			map_type: "mapTiler",
			map_name: "Plan two",
			map_mini: false,
			map_as_image: false,
			map_as_overlay: false,
			calculate_zoom: false,
			attribution: 		'Maps designed by <a href="https://artasmedia.com/" target="_blank" class="vco-knightlab-brand">ArtasMedia</a>',
			mapTiler: {
				path: 				"http://www.southampton.ac.uk/~pw8g08/tour/maps/plan_en_04/",
				lat:				"",
				lng: 				"",
				zoom: 				14,
				minZoom:        	14,
				maxZoom:        	17
				
			}
		}]
	}
];

// Translations for each language used in the site.
// First in list is considered the preferred language.
// Copy and paste section below and create new translation. Do not change keys of object.

tour.translations = {
	en: {
		"tarraco": {
			"slides": [
	            {
	                "text": {
	                    "headline": "Trajanic Period",
	                    "text": "In the Claudian period (the first century AD) we see the emergence of Portus. In this second phase of the site, dominated by the investment made by the Emperor Trajan, we see it reaching its maximum extent.<br/><br/>Under the Emperor Trajan, probably in the period between AD 110-117, the existing harbour was enlarged with the establishment of a hexagonal basin a short distance to the east of the earlier Claudian basin.  It was surrounded by a number of major new buildings, including a temple and precinct, the Palazzo Imperiale and associated administrative buildings, a possible shipyard and many warehouses.<br/><br/>Areas that had been established under Claudius and Nero were also rebuilt. This enlarged port complex was connected both to the Tiber by one new canal, the Canale Romano, and to Rome by an extension of the Via Campana/ Portuensis. Similarly, its connection to Ostia was enhanced via the addition of another new canal heading southwards across the Isola Sacra."
	                },
	                "location": {
	                    "name": "location",
	                    "image": "images/tiny_icon.png",
	                    "icon_size": 1,
	                    "lat": 57.5,
	                    "lon": -90.5,
	                    "zoom": 3,
	                    "line": false
	                },
	                "media": {
	                    "url": "images/images_2/trajanic.jpg",
	                    "credit": "Simon Keay / University of Southampton",
	                    "caption": "Aerial view of the great hexagonal basin built by the Emperor Trajan"
	                }
	            },
	            {
                "text": {
                    "headline": "Pharos",
                    "text": "The Pharos, constructed during the reign of Claudius, continues to dominate the approach to Portus in the Trajanic phase. But the view from the Pharos would have been markedly different. In the Claudian period the view would have shown, presumably, warehouses and other buildings set back from the Claudian quayside. These would have been demolished in the massive building programme initiated by Trajan, leading to the excavation of the huge Trajanic basin, surrounded by some very large buildings on a scale that invites comparison with Imperial Rome itself."
                },
                "location": {
                    "name": "location",
                    "lat": 46.5,
                    "lon": -136.5,
                    "zoom": 4,
                    "line": false
                },
                "media": {
                    "url": "images/images_1/mosaic_ostia.jpg",
                    "credit": "Simon Keay / University of Southampton",
                    "caption": "Depiction of the Pharos at Portus in a mosaic found at Ostia"
                }
            }]
        },
        "puteoli": {
			"slides": [
	            {
                "text": {
                    "headline": "Claudian Basin",
                    "text": "During the Trajanic phase the outer, the Claudian basin would have continued to be filled with ships. We still know very little about the operation of how the harbour basins worked and related to one another, but presumably the Claudian basin, Trajanic basin and the Darsena, together with the Tiber frontage of Ostia to the south, would have served different types of shipping and also allowed for different stages in the management of goods. Perhaps the large ships bringing grain from North Africa and Egypt would have moored commoditiesin the protection of the outer basin, until allocated a slot along the quays that defined the Grandi Magazzini di Traiano and the Portico di Claudio, while those carrying other commdities would have eventually docked in the Trajanic basin. Whilst we cannot be sure how it worked, and lack the crucial written documentation, we do have a sense of the mammoth scale and complexity of the task."
                },
                "location": {
                    "name": "location",
                    "lat": 53,
                    "lon": -115,
                    "zoom": 4,
                    "line": false
                },
                "media": {
                    "url": "images/images_2/claudian_basin.jpg",
                    "credit": "Simon Keay / University of Southampton",
                    "caption": "View across the Claudian basin"
                }
            },
            {
                "text": {
                    "headline": "Monte Giulio",
                    "text": "This area lies immediately behind the eastern quay of the Claudian basin. It is the location of a number of large rectangular buildings interpreted as warehouses, baths and a water cistern. Although the latter has been excavated, nothing is known about its chronology."
                },
                "location": {
                    "name": "location",
                    "lat": 59,
                    "lon": -83,
                    "zoom": 4,
                    "line": false
                },
                "media": {
                    "url": "images/images_2/monte_giulio.jpg",
                    "credit": "Simon Keay / University of Southampton",
                    "caption": "Standing remains of the Trajanic cistern within the area of Monte Giulio"
                }
            }]
        }
    },
    it: {
		"tarraco": {
			"slides": [
	            {
	            "text": {
	                "headline": "Il Periodo Traianeo",
	                "text": "Mentre nel periodo Claudio (I secolo d.C.) si vede l'emergere di Portus, in questa seconda fase dominata dagli investimenti effettuati dall'Imperatore Traiano, lo vediamo raggiungere la sua massima estensione.<br/><br/>Sotto l'Imperatore Traiano, probabilmente nel periodo compreso tra il 110-117 d.C., il porto esistente viene ampliato con la creazione di un bacino esagonale ad est del precedente bacino di Claudio. Il bacino esagonale era circondato da una serie di edifici nuovi importanti, tra cui un tempio e il recinto; il Palazzo Imperiale e gli edifici amministrativi associati; un possibile cantiere e molti magazzini.<br/><br/>Le aree che erano state fondate sotto Claudio e Nerone vengono ricostruite. Questo complesso portuale allargato era collegato al Tevere tramite un nuovo canale, e a Roma da un prolungamento della Via Campana/Portuense. Allo stesso modo, il suo collegamento con Ostia è stato migliorato tramite la creazione di un nuovo canale in direzione sud attraverso l'Isola Sacra."
	            },
	            "location": {
	                "name": "location",
	                "image": "images/tiny_icon.png",
	                "icon_size": 1,
	                "lat": 41.7786,
	                "lon": 12.2582,
	                "zoom": 14,
	                "line": false
	            },
	            "media": {
	                "url": "images/images_2/trajanic.jpg",
	                "credit": "Simon Keay / University of Southampton",
	                "caption": "Vista aerea del grande bacino esagonale costruito dall’Imperatore Traiano"
	            }
	        },
	        {
	            "text": {
	                "headline": "Il Faro",
	                "text": "Il Faro (Pharos), costruito durante il regno di Claudio, continua a dominare l'ingresso di Portus nella fase traianea, nonostante la vista dal faro sia nettamente cambiata. Nel periodo claudio, il paesaggio visibile era formato, presumibilmente, da magazzini e altri edifici in una posizione arretrata rispetto alla banchina claudia. Questi edifici sarebbero stati demoliti dal progetto di costruzione iniziato da Traiano, che prevedeva lo scavo del grande bacino di Traiano, circondato da alcuni edifici maestosi in una scala che invitava al confronto diretto con la Roma Imperiale."
	            },
	            "location": {
	                "name": "location",
	                "lat": 41.775109,
	                "lon": 12.234263,
	                "zoom": 16,
	                "line": false
	            },
	            "media": {
	                "url": "images/images_1/mosaic_ostia.jpg",
	                "credit": "Simon Keay / University of Southampton",
	                "caption": "Immagine del Pharos a Portus in un mosaico ritrovato a Ostia"
	            }
	        }]
	    },
	    "puteoli": {
			"slides": [
	            {
	            "text": {
	                "headline": "Il Bacino di Claudio",
	                "text": "Durante la fase di Traiano, il bacino di Claudio dovrebbe aver continuato ad essere pieno di navi. Sappiamo ancora molto poco sulla funzione dei bacini portuali e su come fossero connessi l'uno all'altro. Presumibilmente, il bacino di Claudio, il bacino di Traiano e la Darsena, insieme alla parte del Tevere a Ostia a sud, avrebbero servito a diversi tipi di trasporto e avrebbe anche permesso il controllo delle diverse fasi della gestione dei beni. É possibile che le grandi navi che trasportavano il grano dal Nord Africa e dall'Egitto ormeggiassero temporaneamente protette dal  bacino esterno, fino all’assegnazione di un posto lungo le banchine che delimitavano i Grandi Magazzini di Traiano e il Portico di Claudio, mentre quelle che trasportano altri beni avrebbero ormeggiato nel bacino traianeo."
	            },
	            "location": {
	                "name": "location",
	                "lat": 41.778086,
	                "lon": 12.246366,
	                "zoom": 16,
	                "line": false
	            },
	            "media": {
	                "url": "images/images_2/claudian_basin.jpg",
	                "credit": "Simon Keay / University of Southampton",
	                "caption": ""
	            }
	        },
	        {
	            "text": {
	                "headline": "Il Monte Giulio",
	                "text": "Questa zona si trova immediatamente alle spalle della banchina orientale del bacino di Claudio e presenta una serie di grandi edifici rettangolari interpretati come magazzini, bagni e una cisterna d'acqua. Nonostante la cisterna sia stata scavata, non si conosce nulla della sua cronologia."
	            },
	            "location": {
	                "name": "location",
	                "lat": 41.784614,
	                "lon": 12.259240,
	                "zoom": 16,
	                "line": false
	            },
	            "media": {
	                "url": "images/images_2/monte_giulio.jpg",
	                "credit": "Simon Keay / University of Southampton",
	                "caption": "Resti della cisterna traianea nell’area di Monte Giulio"
	            }
	        }]
	    }
	}
};
/* ==================================================

StoryTour Angular Application
Designed and built by Peter Wheeler

This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
If a copy of the MPL was not distributed with this file, you can obtain one at http://mozilla.org/MPL/2.0/.

================================================== */

( function(exports, global){
"use strict";

var slideIndex = 0;
var watchID;
var paramVal;
var scopeDiv;
var id;

var languageCounter = function() {
    var ids = [],
    locales = [],
    preferredLocale,
    langLocales,
    urls = [],
    preferredUrl,
    langUrls;

    preferredLocale = tour.languages[0].locale;
    preferredUrl = tour.languages[0].locale.split("-")[0];

    if (tour.languages.length > 1) {
        for (var g = 0; g < tour.languages.length; g++) {
            var h = tour.languages[g];
            ids.push(g.id);
            locales.push(h.locale);
            urls.push(h.locale.split("-")[0]);
        }
    } else {
        ids.push(tour.languages[0].id);
        locales.push(tour.languages[0].locale);
        urls.push(tour.languages[0].locale.split("-")[0]);
    }

    langLocales = locales.join("|");
    langUrls = urls.join("|");
    return {
        ids: ids,
        preferredLocale: preferredLocale,
        locales: locales,
        langLocales: langLocales,
        preferredUrl: preferredUrl,
        urls: urls,
        langUrls: langUrls
    };
}();

function rootConfig($stateProvider, $urlRouterProvider, $locationProvider, $translateProvider, $translatePartialLoaderProvider, translatePluggableLoaderProvider, $urlMatcherFactoryProvider, tmhDynamicLocaleProvider){
    var urlMatcher = $urlMatcherFactoryProvider.compile("/{lang:(?:" + languageCounter.langUrls + ")}/");
    $stateProvider.state("app", {
                    abstract: true,
                    url: urlMatcher,
                    templateUrl: "partials/index.html",
                    controller: "rootCtrl",
                    controllerAs: "root"
                }),
    $stateProvider.state("app.home", {
                    url: "",
                    templateUrl: "partials/home.html"
                }),

    // Redirects and Otherwise //
    $urlRouterProvider.when("/", "/"+ languageCounter.preferredUrl +"/"),
    $urlRouterProvider.otherwise("/404"),
    $locationProvider.html5Mode(true),
    $locationProvider.hashPrefix("!");

    $translateProvider.useLoader('$translatePartialLoader', {
        urlTemplate: "translations/{lang}/{part}.json"
    });

    $translatePartialLoaderProvider.addPart('app');
    $translateProvider.addInterpolation('translateService');

    console.log("Language Loaded");

    $translateProvider.preferredLanguage(languageCounter.preferredLocale);
    $translateProvider.useLocalStorage();
	// Enable escaping of HTML
    $translateProvider.useSanitizeValueStrategy("escaped");
    
    tmhDynamicLocaleProvider.localeLocationPattern("js/angular/i18n/default/angular-locale_{{locale}}.js");
    tmhDynamicLocaleProvider.defaultLocale(languageCounter.preferredLocale);

    console.log("Angular is working");
};

function pagesConfig($stateProvider){
   for (var i = 0; i < tour.pages.length; i++) {
        var j = tour.pages[i];
        $stateProvider.state("app." + j.url, {
            url: j.url,
            templateUrl: "partials/" + j.url + ".html",
            controller: j.url + "Ctrl",
            controllerAs: "vm",
            data: {
                pageTitle: j.title
                }
        });
    }
};

function tourConfig(stateHelperProvider, $urlRouterProvider, $translateProvider, translatePluggableLoaderProvider, $translatePartialLoaderProvider){
    stateHelperProvider.state({
        abstract: true,
        name: "app.tour",
        url: "",
        template: '<div id="tour-view" tour-directive></div>',
        controller: "tourCtrl",
        controllerAs: "vm",
        children: (function(){
            var tourList = [];
            for (var k = 0; k < tour.maps.length; k++) {
                var l = tour.maps[k];
                tourList.push({name: l.id,
                                url: l.url + "?start_at_slide",
                                controllerAs: "vm",
                                controller: "mapsCtrl",
                                params: {id: l.id, name: l.name, url: l.url}
                            })
            }
            return tourList;
        })()
    });
    $translateProvider.useInterpolation('translateService');
};

// function tourConfig($stateProvider){
//  $stateProvider.state("app.tour", {
//         // abstract: true,
//         url: "tour",
//         templateUrl: "partials/tour.html",
//         controller: "tourCtrl",
//         controllerAs: "vm"
//         // data: {
//         //     // pageTitle: j.title
//         //     }
//     });
// };

// It can't make the same thing twice
// function mapsConfig($stateProvider, map){
//         $stateProvider.state("app.tour." + map, {
//             url: ":" + map + "?prim&sec&tert",
//             template: '<div maps-directive></div>',
//             controller: "mapsCtrl",
//             controllerAs: "vm",
//             params: {   
//                 id: {squash: true, value: null },
//                 prim: {squash: true, value: null },
//                 sec: {squash: true, value: null },
//                 tert: {squash: true, value: null }
//             },
//             data: {
//                 pageTitle: map
//                 }
//         });
// };

function runCtrl($rootScope, $translate, tmhDynamicLocale, $location, $stateParams, $state){

    var vm = this;
    $rootScope.$on('$stateChangeSuccess', function(event, toState, toParams, fromState, fromParams) {

        $rootScope.currentLang = $stateParams.lang;

        if($rootScope.currentLang){
            for (var i = 0; i < languageCounter.locales.length; i++) {
                var urlCode = languageCounter.locales[i].split("-")[0];
                if(urlCode === $rootScope.currentLang){
                    $translate.use(urlCode);
                    $translate.refresh();
                    tmhDynamicLocale.set(languageCounter.locales[i]);
                }
            }
        }
        else if (!$rootScope.currentLang) {
            $translate.use(languageCounter.preferredUrl);
            $translate.refresh();
            tmhDynamicLocale.set(languageCounter.preferredLocale);
        }
        console.log("CurrentLang: " + $rootScope.currentLang, "Use: " + $translate.use(), "Proposed: " + $translate.proposedLanguage(), "Locale: " + tmhDynamicLocale.get());
    });

    $rootScope.$on('$translatePartialLoaderStructureChanged', function () {
        $translate.refresh();
    });
};

function translateTourLoader($q, $timeout){
    return function(options) {
        var translations = {};
        var lang;
        var defer = $q.defer();

        if(options.key) {
            lang = options.key;
            translations = tour.translations[lang];
        } else {
            translations = tour.translations[0];
        }
        
        defer.resolve(translations);
        return defer.promise;
    }
};


// function translateFactory($http, $q, translateTourLoader){
//     return {
//         getData: function(){
//             var defer = $q.defer();
//             console.log(translateTourLoader());
//             defer.resolve(translateTourLoader)

//             return defer.promise
//             .then(function(response) {
//                 if (response.data === key) {
//                     return translations;
//                 } else {
//                     // invalid response
//                     return defer.reject('Oops... invalid response');
//                 }

//             }, function(response) {
//                 // something went wrong
//                 return defer.reject('Oops... something went wrong');
//             });
//         }
//     };
// };

function translateService($interpolate){
    var $locale;

    return {
 
    setLocale: function (locale) {
      $locale = locale;
    },
 
    getInterpolationIdentifier: function () {
      return 'custom';
    },
 
    interpolate: function (string, interpolateParams, sanitizeStrategy) {
      return $interpolate(string)(interpolateParams, sanitizeStrategy);
    },

    changeLocale: function(){

    }
  };
}

// Get Factory to return array of JSON
function mapsFactory($state, $stateParams, $http, $q){
    // var test;
    // $http.get("json/period_2.json").success(function(response) {
    //     test = response;
    // }); 
    return {
    }
};

function mapsService($state, $stateParams, $http, $q){
};

function rootCtrl($scope, $window, $log, $locale, localStorageService, $translate, $filter, $state, $rootScope, $location, $stateParams, tmhDynamicLocale) {
    $rootScope.startLang = languageCounter.preferredUrl;
    $rootScope.startLangId = languageCounter.preferredLocale;

    if (!$rootScope.startLang || tour.languages.length === 0) {
        console.error('There are no languages provided');
    }
    $translate.use($rootScope.startLang);
    tmhDynamicLocale.set($rootScope.startLangId);

    $scope.firstTour = tour.maps[0].id;
    $scope.lang = $stateParams.lang;

    angular.element(function() {
        $(".menu-collapse").sideNav({
            menuWidth: 280, // Default is 240
            edge: 'right', // Choose the horizontal origin
            closeOnClick: true, // Closes side-nav on <a> clicks, useful for Angular/Meteor
            draggable: true // Choose whether you can drag to open on touch screen
        });
        $('.collapsible').collapsible();
    });
};

function menuCtrl($scope, $location, $state, $stateParams){
    var langList = [];
    var pageList = [];
    var tourList =  [];

    for (var a = 0; a < tour.languages.length; a++) {
        var b = tour.languages[a];
            langList.push({"id": b.id, "url": b.locale.split("-")[0]});
    }

    for (var c = 0; c < tour.pages.length; c++) {
        var d = tour.pages[c];
            pageList.push({"url": d.url, "name": d.name});
    }

    for (var e = 0; e < tour.maps.length; e++) {
        var f = tour.maps[e];
            tourList.push({"id": f.id, "url": f.url});
    }

    $scope.langList = langList;
    $scope.pageList = pageList;
    $scope.tourList = tourList;
};

function aboutCtrl($scope, $location, $stateParams, $translate, $translatePartialLoader){
};

function teamCtrl($scope, $location, $stateParams, $translate, $translatePartialLoader){
};

function tourCtrl($scope, $location, $stateParams, $translate, $translatePartialLoader){
};

function mapsCtrl($scope, $rootScope, $location, $stateParams, $q, $timeout, $translate, $translatePartialLoader){
    $translatePartialLoader.addPart($stateParams.name);
    $translate.refresh()

	$scope.countchange = function(langKey){
		$translate.use(langKey);
		$translate.refresh();
	};

    $scope.$watch('map', function(map) {
        if(map) {
            map = {n: "asddasds"}
            // $scope.storytour.slide = new VCO.StoryTour.Slide(storytour, "json/period_2.json", storymap_options);
        }
    });
};

function tourDirective($timeout){
    var link = function($scope, element, attr){
        $scope.storymap_options = {
            script_path: "js",
            width: "100%",
            height: "100%",
            language: "en",
            start_at_slide: 0,
            show_lines: false,
            use_custom_markers: true,
            show_history_line: false,
            map_background_color: "#ffffff",
            // map config
            map_type: "tileMill",
            map_mini: true,
            map_as_image: false,
            calculate_zoom: false,
            maps: $scope.mapData
        };

        $scope.storytour = new VCO.StoryTour("storytour", "translations/" + $scope.langData + "/" + $scope.jsonData + ".json", $scope.storymap_options);
            // $timeout(function() {
            //     $scope.test = new VCO.StoryTour.Slide($scope.storytour, "json/" + $scope.jsonData + ".json", $scope.storymap_options);
            // }, 1000);

        $timeout(function () {
            angular.element(function() {
                $('.menubar-collapse').sideNav({
                menuWidth: 280, // Default is 240
                edge: 'left', // Choose the horizontal origin
                closeOnClick: true, // Closes side-nav on <a> clicks, useful for Angular/Meteor
                draggable: true // Choose whether you can drag to open on touch screen
                }); 
                $('.collapsible-menubar').collapsible();
                $('.modal').modal();
                $('.tooltipped').tooltip({delay: 50});
            });
        }, 500);
    }
    return {
        restrict: 'EA',
        replace: false,
        templateUrl: 'partials/maps.html',
        controller: function($scope, $stateParams){
            $scope.langData = $stateParams.lang;
            $scope.jsonData = $stateParams.url;
            $scope.mapData = tour.maps[$stateParams.id].maps;
        },
        controllerAs: 'vm',
        scope: true,
        link: link
    };
};

var appConfig = function(){
    var appName = "StoryTour",
    appDependencies = ["additionalViews", "ui.router", "ui.router.stateHelper", "LocalStorageModule", "pascalprecht.translate", "angular-translate-loader-pluggable", "tmh.dynamicLocale", "ngSanitize", "ngAnimate", "ngCookies"],

    pushLateModules = function(lateModule, dependencies) {
        angular.module(lateModule, dependencies || []),
        angular.module(appName).requires.push(lateModule);
        };

    return {
        appName: appName,
        appDependencies: appDependencies,
        pushLateModules: pushLateModules
    };
}();

angular.module("additionalViews", []),
angular.module(appConfig.appName, appConfig.appDependencies),
angular.module(appConfig.appName).config(rootConfig),
rootConfig.$inject = ["$stateProvider", "$urlRouterProvider", "$locationProvider", "$translateProvider", "$translatePartialLoaderProvider", "translatePluggableLoaderProvider", "$urlMatcherFactoryProvider", "tmhDynamicLocaleProvider"],

// appConfig.pushLateModules("StoryTour.localeConfig"),
// angular.module("StoryTour.localeConfig").config(localeConfig),
// localeConfig.$inject = ["tmhDynamicLocale"],

appConfig.pushLateModules(appConfig.appName + ".pages"),
angular.module(appConfig.appName + ".pages").config(pagesConfig),
pagesConfig.$inject = ["$stateProvider"],

appConfig.pushLateModules(appConfig.appName + ".tour"),
angular.module(appConfig.appName + ".tour").config(tourConfig),
tourConfig.$inject = ["stateHelperProvider", "$urlRouterProvider", "$translateProvider", "translatePluggableLoaderProvider", "$translatePartialLoaderProvider"];

angular.module(appConfig.appName).run(runCtrl),
runCtrl.$inject = ["$rootScope", "$translate", "tmhDynamicLocale", "$location", "$stateParams", "$state"]

angular.module(appConfig.appName).factory("translateTourLoader", translateTourLoader),
translateTourLoader.$inject = ["$q", "$timeout"],

// angular.module(appConfig.appName).factory("translateFactory", translateFactory),
// translateFactory.$inject = ["$http", "$q", "translateTourLoader"],

angular.module(appConfig.appName + ".tour").service("translateService", translateService),
translateService.$inject = ["$interpolate"],

angular.module(appConfig.appName + ".tour").factory("mapsFactory", mapsFactory),
mapsFactory.$inject = ["$state", "$stateParams", "$http", "$q"],

angular.module(appConfig.appName + ".tour").service("mapsService", mapsService),
mapsService.$inject = ["$state", "$stateParams", "$http", "$q"],

angular.module(appConfig.appName).controller("rootCtrl", rootCtrl),
rootCtrl.$inject = ["$scope", "$window", "$log", "$locale", "localStorageService", "$translate", "$filter", "$state", "$rootScope", "$location", "$stateParams", "tmhDynamicLocale"],

angular.module(appConfig.appName).controller("menuCtrl", menuCtrl),
menuCtrl.$inject = ["$scope", "$location", "$state", "$stateParams"],

angular.module(appConfig.appName + ".pages").controller("aboutCtrl", aboutCtrl),
aboutCtrl.$inject = ["$scope", "$location", "$stateParams", "$translate", "$translatePartialLoader"],

angular.module(appConfig.appName + ".pages").controller("teamCtrl", teamCtrl),
teamCtrl.$inject = ["$scope", "$location", "$stateParams", "$translate", "$translatePartialLoader"],

angular.module(appConfig.appName + ".tour").controller("tourCtrl", tourCtrl),
tourCtrl.$inject = ["$scope", "$location", "$stateParams", "$translate", "$translatePartialLoader"],

angular.module(appConfig.appName + ".tour").controller("mapsCtrl", mapsCtrl),
mapsCtrl.$inject = ["$scope", "$rootScope", "$location", "$stateParams", "$q", "$timeout", "$translate", "$translatePartialLoader"],

angular.module(appConfig.appName + ".tour").directive("tourDirective", tourDirective),
tourDirective.$inject = ["$timeout"]

}({VCO}, function() {return this;}() ),

angular.module("additionalViews").run(["$templateCache", function($templateCache){
    $templateCache.put("navigation.html", '<div class="st-sidebar-wrapper"><div class="st-sidebar"></div><div class="trapezoid"></div></div>'),$templateCache.put("navShell.html", '<div ui-directive></div>');
}])

);
